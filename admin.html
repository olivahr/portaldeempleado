<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Employee Portal | Admin</title>
  <link rel="stylesheet" href="./assets/app.css"/>
</head>

<body class="app-bg">

<header class="topbar">
  <div class="topbar-left" style="display:flex;align-items:center;gap:10px;">
    <div class="brand-mini">
      <div class="brand-dot"></div>
      <div>
        <div class="brand-title">Employee Portal</div>
        <div class="brand-sub" style="opacity:.9;">Admin Panel</div>
      </div>
    </div>

    <!-- Active employee badge (filled by admin.js) -->
    <div class="topbar-pill" id="activeEmpPill" style="display:none;">
      Employee: <span id="activeEmpText" style="font-weight:950;margin-left:6px;">SP---</span>
    </div>
  </div>

  <div class="topbar-right">
    <div class="topbar-pill" id="adminBadge">Admin</div>
    <button class="btn sm ghost" id="btnLogout" type="button">Log out</button>
  </div>
</header>

<main class="content">

  <!-- ADMIN HEADER / STATUS -->
  <section class="page-head">
    <h1 style="margin:0;">Admin Dashboard</h1>
    <div class="subhead" style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
      <span class="muted">Load an employee, then update modules below.</span>
      <span class="muted">•</span>
      <span class="muted" id="adminStatus">Firebase Connected</span>
    </div>
  </section>

  <!-- SEARCH + QUICK ACTIONS -->
  <section class="card" id="secSearch">
    <h3 class="h3">Employee Lookup</h3>

    <div class="grid2" style="align-items:end;">
      <div>
        <div class="small muted" style="font-weight:950;margin-bottom:8px;">Employee ID</div>
        <input id="searchEmpId" class="inp" placeholder="SP023">
        <div class="small muted" style="margin-top:8px;line-height:1.35;">
          Tip: IDs are SP###. Once loaded, all modules save to that employee.
        </div>
      </div>

      <div>
        <button class="btn primary" id="btnSearch" type="button" style="width:100%;border-radius:16px;">
          Load Employee
        </button>
        <div class="small muted" id="searchMsg" style="margin-top:10px;min-height:16px;"></div>
      </div>
    </div>

    <div style="height:10px"></div>

    <!-- Quick Jump “app feel” -->
    <div class="small muted" style="font-weight:950;margin-bottom:8px;">Quick Jump</div>
    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <a class="btn sm ghost" href="#secAppointment">Appointment</a>
      <a class="btn sm ghost" href="#secSchedule">Schedule</a>
      <a class="btn sm ghost" href="#secPayroll">Payroll</a>
      <a class="btn sm ghost" href="#secTimeOff">Time Off</a>
      <a class="btn sm ghost" href="#secHours">Hours</a>
      <a class="btn sm ghost" href="#secDeposit">Direct Deposit</a>
      <a class="btn sm ghost" href="#secNotifications">Notifications</a>
      <a class="btn sm ghost" href="#secTeam">Team</a>
      <a class="btn sm ghost" href="#secAllowed">Allowed IDs</a>
      <a class="btn sm ghost" href="#secCompany">Company Settings</a>
    </div>
  </section>

  <!-- ACTIVE EMPLOYEE SUMMARY -->
  <section class="card" id="secActiveEmp" style="display:none;">
    <h3 class="h3">Active Employee</h3>

    <div class="kv" style="margin-top:0;">
      <div class="k">Employee ID</div><div class="v" id="empSummary_id">—</div>
      <div class="k">Name</div><div class="v" id="empSummary_name">—</div>
      <div class="k">Status</div><div class="v" id="empSummary_status">Loaded</div>
    </div>

    <div class="small muted" style="margin-top:10px;line-height:1.35;">
      Everything below saves into this employee profile.
    </div>
  </section>

  <!-- APPOINTMENT -->
  <section class="card" id="secAppointment">
    <h3 class="h3">Appointment</h3>
    <div class="small muted" style="margin-top:-4px;line-height:1.35;">
      Set first-day check-in details (shown to employee in Progress + First Day).
    </div>

    <div style="height:10px"></div>

    <div class="grid2">
      <div>
        <div class="small muted" style="font-weight:950;margin-bottom:8px;">Date</div>
        <input id="aDate" class="inp" type="date">
      </div>
      <div>
        <div class="small muted" style="font-weight:950;margin-bottom:8px;">Time</div>
        <input id="aTime" class="inp" type="time">
      </div>
    </div>

    <input id="aAddr" class="inp" placeholder="Address">
    <input id="aNotes" class="inp" placeholder="Notes">

    <button class="btn primary" id="btnSaveAppointment" type="button" style="width:100%;border-radius:16px;">
      Save Appointment
    </button>
    <div class="small muted" id="apptMsg" style="min-height:16px;"></div>
  </section>

  <!-- SCHEDULE / CALENDAR -->
  <section class="card" id="secSchedule">
    <h3 class="h3">Schedule / Calendar</h3>
    <div class="small muted">Weekly schedule (Mon–Sun). Type: work / off / holiday.</div>

    <div style="height:10px"></div>

    <div class="grid2">
      <div>
        <div class="small muted" style="font-weight:950;">Monday</div>
        <input id="sch_mon_start" class="inp" placeholder="Start (e.g. 06:00 AM)">
        <input id="sch_mon_end" class="inp" placeholder="End (e.g. 02:30 PM)">
        <select id="sch_mon_type" class="inp">
          <option value="work">work</option>
          <option value="off">off</option>
          <option value="holiday">holiday</option>
        </select>
      </div>

      <div>
        <div class="small muted" style="font-weight:950;">Tuesday</div>
        <input id="sch_tue_start" class="inp" placeholder="Start">
        <input id="sch_tue_end" class="inp" placeholder="End">
        <select id="sch_tue_type" class="inp">
          <option value="work">work</option>
          <option value="off">off</option>
          <option value="holiday">holiday</option>
        </select>
      </div>

      <div>
        <div class="small muted" style="font-weight:950;">Wednesday</div>
        <input id="sch_wed_start" class="inp" placeholder="Start">
        <input id="sch_wed_end" class="inp" placeholder="End">
        <select id="sch_wed_type" class="inp">
          <option value="work">work</option>
          <option value="off">off</option>
          <option value="holiday">holiday</option>
        </select>
      </div>

      <div>
        <div class="small muted" style="font-weight:950;">Thursday</div>
        <input id="sch_thu_start" class="inp" placeholder="Start">
        <input id="sch_thu_end" class="inp" placeholder="End">
        <select id="sch_thu_type" class="inp">
          <option value="work">work</option>
          <option value="off">off</option>
          <option value="holiday">holiday</option>
        </select>
      </div>

      <div>
        <div class="small muted" style="font-weight:950;">Friday</div>
        <input id="sch_fri_start" class="inp" placeholder="Start">
        <input id="sch_fri_end" class="inp" placeholder="End">
        <select id="sch_fri_type" class="inp">
          <option value="work">work</option>
          <option value="off">off</option>
          <option value="holiday">holiday</option>
        </select>
      </div>

      <div>
        <div class="small muted" style="font-weight:950;">Saturday</div>
        <input id="sch_sat_start" class="inp" placeholder="Start">
        <input id="sch_sat_end" class="inp" placeholder="End">
        <select id="sch_sat_type" class="inp">
          <option value="work">work</option>
          <option value="off">off</option>
          <option value="holiday">holiday</option>
        </select>
      </div>

      <div>
        <div class="small muted" style="font-weight:950;">Sunday</div>
        <input id="sch_sun_start" class="inp" placeholder="Start">
        <input id="sch_sun_end" class="inp" placeholder="End">
        <select id="sch_sun_type" class="inp">
          <option value="work">work</option>
          <option value="off">off</option>
          <option value="holiday">holiday</option>
        </select>
      </div>

      <!-- Filler for grid balance on desktop -->
      <div style="display:none;"></div>
    </div>

    <div style="height:10px"></div>
    <button class="btn primary" id="btnSaveSchedule" type="button" style="width:100%;border-radius:16px;">
      Save Schedule
    </button>
    <div class="small muted" id="scheduleMsg" style="min-height:16px;"></div>

    <div style="height:12px"></div>
    <div class="small muted" style="font-weight:950;">Upcoming Shifts (optional)</div>
    <div id="scheduleList"></div>
  </section>

  <!-- PAYROLL -->
  <section class="card" id="secPayroll">
    <h3 class="h3">Payroll</h3>
    <div class="small muted">Upload Pay Stub PDF and attach to employee.</div>

    <div style="height:10px"></div>

    <div class="grid2">
      <div>
        <div class="small muted" style="font-weight:950;margin-bottom:8px;">Pay Date</div>
        <input id="pay_payDate" class="inp" type="date" />
      </div>
      <div>
        <div class="small muted" style="font-weight:950;margin-bottom:8px;">PDF</div>
        <input id="pay_pdf" class="inp" type="file" accept="application/pdf" />
      </div>
    </div>

    <div class="grid2">
      <div>
        <div class="small muted" style="font-weight:950;margin-bottom:8px;">Period Start</div>
        <input id="pay_periodStart" class="inp" type="date" />
      </div>
      <div>
        <div class="small muted" style="font-weight:950;margin-bottom:8px;">Period End</div>
        <input id="pay_periodEnd" class="inp" type="date" />
      </div>
    </div>

    <button class="btn primary" id="btnUploadPayStub" type="button" style="width:100%;border-radius:16px;">
      Upload Pay Stub
    </button>
    <div class="small muted" id="payrollMsg" style="min-height:16px;"></div>

    <div style="height:12px"></div>
    <div class="small muted" style="font-weight:950;">Employee Pay Stubs</div>
    <div id="payrollList"></div>
  </section>

  <!-- TIME OFF -->
  <section class="card" id="secTimeOff">
    <h3 class="h3">Time Off Requests</h3>
    <div class="small muted">Review employee requests. Approve / Deny.</div>

    <div style="height:10px"></div>
    <div id="timeoffList"></div>
  </section>

  <!-- HOURS -->
  <section class="card" id="secHours">
    <h3 class="h3">Hours</h3>
    <div class="small muted">Set weekly total hours and overtime for employee.</div>

    <div style="height:10px"></div>

    <div class="grid2">
      <div>
        <div class="small muted" style="font-weight:950;margin-bottom:8px;">Week Start</div>
        <input id="hrs_weekStart" class="inp" type="date" />
      </div>
      <div>
        <div class="small muted" style="font-weight:950;margin-bottom:8px;">Totals</div>
        <div class="grid2" style="gap:10px;">
          <input id="hrs_total" class="inp" placeholder="Total Hours (e.g. 40)" />
          <input id="hrs_ot" class="inp" placeholder="Overtime (e.g. 5)" />
        </div>
      </div>
    </div>

    <button class="btn primary" id="btnSaveHours" type="button" style="width:100%;border-radius:16px;">
      Save Hours
    </button>
    <div class="small muted" id="hoursMsg" style="min-height:16px;"></div>

    <div style="height:12px"></div>
    <div class="small muted" style="font-weight:950;">Past Weeks</div>
    <div id="hoursList"></div>
  </section>

  <!-- DIRECT DEPOSIT -->
  <section class="card" id="secDeposit">
    <h3 class="h3">Direct Deposit</h3>
    <div class="small muted">Employee view is read-only. Admin can update.</div>

    <div style="height:10px"></div>

    <div class="grid2">
      <div>
        <div class="small muted" style="font-weight:950;margin-bottom:8px;">Bank Name</div>
        <input id="dep_bankName" class="inp" placeholder="Bank Name">
      </div>
      <div>
        <div class="small muted" style="font-weight:950;margin-bottom:8px;">Account (Last 4)</div>
        <input id="dep_last4" class="inp" placeholder="Last 4 Account Digits (e.g. 1234)">
      </div>
    </div>

    <button class="btn primary" id="btnSaveDeposit" type="button" style="width:100%;border-radius:16px;">
      Save Deposit Info
    </button>
    <div class="small muted" id="depositMsg" style="min-height:16px;"></div>
  </section>

  <!-- NOTIFICATIONS -->
  <section class="card" id="secNotifications">
    <h3 class="h3">Notifications</h3>
    <div class="small muted">Post a notification to the loaded employee.</div>

    <div style="height:10px"></div>

    <input id="nTitle" class="inp" placeholder="Title">
    <input id="nBody" class="inp" placeholder="Message">

    <div class="grid2">
      <div>
        <div class="small muted" style="font-weight:950;margin-bottom:8px;">Route</div>
        <select id="nRoute" class="inp">
          <option value="progress">Progress</option>
          <option value="i9">I-9</option>
          <option value="shift">Shift</option>
          <option value="footwear">Safety Footwear</option>
          <option value="documents">Documents</option>
          <option value="firstday">First Day</option>

          <option value="schedule">Schedule</option>
          <option value="payroll">Payroll</option>
          <option value="timeoff">Time Off</option>
          <option value="hours">My Hours</option>
          <option value="deposit">Direct Deposit</option>
        </select>
      </div>
      <div>
        <button class="btn primary" id="btnAddNotif" type="button" style="width:100%;border-radius:16px;">
          Add Notification
        </button>
      </div>
    </div>

    <div style="height:12px"></div>
    <div class="small muted" style="font-weight:950;">Employee Notifications</div>
    <div id="notifList"></div>
  </section>

  <!-- TEAM -->
  <section class="card" id="secTeam">
    <h3 class="h3">Team</h3>
    <div class="small muted">Assign contacts shown in employee “Team / Help”.</div>

    <div style="height:10px"></div>

    <div class="grid2">
      <input id="tName" class="inp" placeholder="Name">
      <input id="tRole" class="inp" placeholder="Role">
    </div>
    <div class="grid2">
      <input id="tEmail" class="inp" placeholder="Email">
      <input id="tPhone" class="inp" placeholder="Phone">
    </div>

    <button class="btn primary" id="btnAddTeam" type="button" style="width:100%;border-radius:16px;">
      Add Team Member
    </button>

    <div style="height:12px"></div>
    <div class="small muted" style="font-weight:950;">Assigned Team</div>
    <div id="teamList"></div>
  </section>

  <!-- ALLOWED IDS -->
  <section class="card" id="secAllowed">
    <h3 class="h3">Allowed Employee IDs</h3>
    <div class="small muted">Control which Employee IDs can register (SP###).</div>

    <div style="height:10px"></div>

    <div class="grid2">
      <input id="newEmpId" class="inp" placeholder="SP023">
      <input id="newEmpName" class="inp" placeholder="Name (optional)">
    </div>

    <button class="btn primary" id="btnAddAllowed" type="button" style="width:100%;border-radius:16px;">
      Add ID
    </button>

    <div style="height:12px"></div>
    <div class="small muted" style="font-weight:950;">Allowed List</div>
    <div id="allowedList"></div>
  </section>

  <!-- COMPANY SETTINGS -->
  <section class="card" id="secCompany">
    <h3 class="h3">Company Settings</h3>
    <div class="small muted">Global portal content (portal/public).</div>

    <div style="height:10px"></div>

    <div class="small muted" style="font-weight:950;">Safety Footwear</div>
    <input id="c_shopUrl" class="inp" placeholder="Safety footwear shop URL (https://...)">

    <div style="height:10px"></div>

    <div class="small muted" style="font-weight:950;">HR Contact</div>
    <div class="grid2">
      <input id="c_helpEmail" class="inp" placeholder="HR email (e.g. hr@company.com)">
      <input id="c_helpPhone" class="inp" placeholder="HR phone (optional)">
    </div>
    <input id="c_helpText" class="inp" placeholder="Help message shown in Help page">

    <button class="btn primary" id="btnSaveCompany" type="button" style="width:100%;border-radius:16px;">
      Save Company Settings
    </button>
    <div class="small muted" id="companyMsg" style="min-height:16px;"></div>
  </section>

  <footer class="footer">
    <span class="muted">Employee Portal</span> •
    <span class="muted">Admin</span>
  </footer>

</main>

<script type="module">
  import { uiSetText } from "./assets/ui.js";
  import { onAuth, signOutNow } from "./assets/auth.js";
  import { initAdminApp } from "./assets/admin.js";

  document.getElementById("btnLogout").addEventListener("click", async () => {
    await signOutNow();
    window.location.href = "./index.html";
  });

  onAuth(async (user) => {
    uiSetText(document.getElementById("adminBadge"), user?.email || "Admin");
    await initAdminApp(user);
  });

  // Optional helper hooks for admin.js to show active employee in UI (if it wants)
  // admin.js can set:
  //   document.getElementById("secActiveEmp").style.display = ""
  //   document.getElementById("activeEmpPill").style.display = ""
  //   document.getElementById("activeEmpText").textContent = "SP023"
  //   document.getElementById("empSummary_id").textContent = "SP023"
  //   document.getElementById("empSummary_name").textContent = "John Doe"
</script>

</body>
</html>
